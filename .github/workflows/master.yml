name: Branch Deploy
on:
  push:
    branch:
      - 'master'
    paths-ignore: # 下列文件的变更不触发部署
      - .editorconfig
      - .eslintrc
      - .gitignore
      - .prettierrc
      - README.md
      - LICENSE

jobs: # 工作流
  branch-deploy: # 工作流名称
    runs-on: ubuntu-latest # 使用ubuntu系统镜像运行自动化
    steps:
        - name: Checkout
          uses: actions/checkout@master
        
        - name: Install Dependencies
          uses: actions/setup-node@master
          run: npm install

        - name: Build
          run: npm run build
        
        - name: Release
          run: tar -zcvf release.tgz .nuxt static utils config.js nuxt.config.js package.json package-lock.json pm2.config.json

        - name: ls -a
          run: ls -a

        - name: FTP Deployer
          uses: sand4rt/ftp-deployer@v0.9
          with:
            # FTP host URL like: ftp.host.com
            host: ${{ secrets.HOST }}
            # FTP port default is: 21
            port: 21 # optional
            # Ftp username
            username: ${{ secrets.USERNAME }}
            # Ftp password
            password: ${{ secrets.PASSWORD }}
            # The remote folder location of your FTP server
            remote_folder: /webapp/test # optional
            # The local folder location
            local_folder: release.tgz # optional, default is dist
            # Remove existing files inside FTP remote folder
            cleanup: false # optional
            include: '' # optional
            exclude: # optional
              - node_modules/**
              - node_modules/**/.*
              - .git/**
              - *.env
            pasive: true # optional