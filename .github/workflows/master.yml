name: Branch Deploy
on:
  push:
    branch:
      - 'master'
    paths-ignore: # 下列文件的变更不触发部署
      - .editorconfig
      - .eslintrc
      - .gitignore  
      - .prettierrc
      - README.md
      - LICENSE

jobs: # 工作流
  branch-deploy: # 工作流名称
    runs-on: ubuntu-latest # 使用ubuntu系统镜像运行自动化
    steps:
        - name: Checkout
          uses: actions/checkout@master
        
        - name: Install
          run: npm install

        - name: Build
          run: npm run build
        
        - name: Release
          run: tar -zcvf release.tgz .nuxt static utils config.js nuxt.config.js package.json package-lock.json pm2.config.json

        - name: ls -a
          run: ls -a
        
        # 为了将资源部署到云服务器，此处下载一个ssh传资料的工具
        - name: Setup sshpass
          run: sudo apt-get install sshpass

        # 部署
        - name: copy file via ssh password
          uses: appleboy/scp-action@master
          with:
            host: ${{ secrets.HOST }}
            username: ${{ secrets.USERNAME }}
            password: ${{ secrets.PASSWORD }}
            port: ${{ secrets.PORT }}
            source: "release.tgz"
            target: "/webapp/test"